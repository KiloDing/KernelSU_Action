KERNEL_SOURCE=https://github.com/MiCode/Xiaomi_Kernel_OpenSource.git
KERNEL_BRANCH=pipa-t-oss
KERNEL_CONFIG=pipa_user_defconfig   # 或实际 defconfig 名，通常小米内核为 pipa_user_defconfig / pipa_defconfig 等；如果你不确定，可在源码 arch/arm64/configs/ 下查看常见文件，如 pipa_defconfig
ARCH=arm64
KERNEL_IMAGE_NAME=Image.gz-dtb   # 小米 sm8250 系列常见为 Image.gz-dtb 或 Image.gz；如果编译后输出是 Image，则改为 Image

# 编译器设置（推荐使用 Clang，pipa 是较新内核，Clang 兼容好）
CLANG_VERSION=14.0.6   # 或更高，如 r450784d / master
CLANG_BRANCH=master   # 或 master
# 如果想用 Proton-Clang 等自定义：
CUSTOM_CLANG_SOURCE=https://github.com/kdrag0n/proton-clang.git

ENABLE_GCC_64=true   # 如果需要 32/64 混合编译，可启用
ENABLE_GCC_32=true

EXTRA_CMDS=LLVM=1 LLVM_IAS=1   # 常见 Clang 编译旗标，可根据需要调整

# KernelSU 相关（非 GKI 必须用旧版）
ENABLE_KERNELSU=true
KERNELSU_TAG=v0.9.5   # 必须 ≤ v0.9.5，KernelSU 1.0+ 不支持非 GKI
ADD_KPROBES_CONFIG=true   # 自动注入 Kprobes 支持（KernelSU 必需）
ADD_OVERLAYFS_CONFIG=true   # 启用 overlayfs（模块支持必需）
APPLY_KERNELSU_PATCH=true   # 如果自动注入失败，手动打补丁

# 其他优化
DISABLE_LTO=true   # 如果编译出错，可禁用 LTO
DISABLE_CC_WERROR=true   # 忽略警告转错误
ENABLE_CCACHE=true   # 加速二次编译
REMOVE_UNUSED_PACKAGES=true

# AnyKernel3（打包成 flashable zip）
CUSTOM_ANYKERNEL3_SOURCE=https://github.com/osm0sis/AnyKernel3.git   # 默认即可，或自定义小米适配版
ANYKERNEL3_BRANCH=master

# 如果需要打包 boot.img（推荐启用，便于 fastboot flash）
BUILD_BOOT_IMG=flash
SOURCE_BOOT_IMAGE=https://your-link-to-stock-boot.img   # 必须提供一个与当前内核版本匹配的官方 boot.img 下载直链（从小米官方 ROM 提取，或从相同 HyperOS/MIUI 版本获取）
NEED_DTBO=true   # 小米平板通常需要 dtbo.img
